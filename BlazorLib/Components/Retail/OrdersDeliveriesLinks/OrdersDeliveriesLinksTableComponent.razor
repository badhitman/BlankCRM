@inherits BlazorBusyComponentBaseModel

@using BlazorLib.Components.Retail.Delivery
@using MudBlazor

<MudTable ServerData="ServerReload" Dense Hover @ref=tableRef>
    <ToolBarContent>
        @if (fullScale > 0 && (OrderId > 0 || DeliveryId > 0 && (DeliveryId == 0 || OrderId == 0)))
        {
            <MudText Typo="Typo.h6">Общий вес: @fullScale</MudText>
        }
        <MudSpacer />
        @if (DeliveryId > 0)
        {
            <MudTooltip Text="Добавить созданный ранее заказ в текущую доставку">
                <MudButton OnClick=IncludeExistOrderOpenDialog
                           Variant="Variant.Outlined"
                           EndIcon="@Icons.Material.Filled.DeviceHub"
                           IconColor="Color.Secondary">Включить существующий заказ</MudButton>
            </MudTooltip>
        }
        @if (OrderId > 0)
        {
            <MudTooltip Text="Добавить заказ в созданную ранее доставку">
                <MudButton OnClick=IncludeExistDeliveryOpenDialog
                           Variant="Variant.Outlined"
                           EndIcon="@Icons.Material.Filled.DeviceHub"
                           IconColor="Color.Secondary">Включить в доставку</MudButton>
            </MudTooltip>
        }
    </ToolBarContent>
    <HeaderContent>
        <MudTh>Доставка</MudTh>
        <MudTh>Заказ</MudTh>
        <MudTh>Вес</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Доставка">@context.DeliveryDocument</MudTd>
        <MudTd DataLabel="Заказ">@context.OrderDocument</MudTd>
        <MudTd DataLabel="Вес">@context.WeightShipping</MudTd>
    </RowTemplate>
    <NoRecordsContent>
        <MudText>No matching records found</MudText>
    </NoRecordsContent>
    <LoadingContent>
        <MudText>Loading...</MudText>
    </LoadingContent>
    <PagerContent>
        <MudTablePager />
    </PagerContent>
</MudTable>

<MudDialog @bind-Visible="_visibleIncludeExistDelivery" Options="_dialogOptions">
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Icon="@Icons.Material.Filled.Edit" Class="mr-3" />Укажите доставку (розница)
        </MudText>
    </TitleContent>
    <DialogContent>
        <CascadingValue Name="ClientId" Value="ClientId">
            <DeliveriesDocumentsManageComponent RowClickEventHandler="SelectDeliveryRowAction" />
        </CascadingValue>
    </DialogContent>
</MudDialog>

<MudDialog @bind-Visible="_visibleIncludeOrder" Options="_dialogOptions">
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Icon="@Icons.Material.Filled.Edit" Class="mr-3" />Укажите заказ (для добавления к доставке)
        </MudText>
    </TitleContent>
    <DialogContent>
        <CascadingValue Name="ClientId" Value="ClientId">
            <RetailOrdersListComponent RowClickEventHandler="SelectOrderRowAction" />
        </CascadingValue>
    </DialogContent>
</MudDialog>