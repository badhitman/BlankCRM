@using MudBlazor
@inherits BlazorBusyComponentBaseAuthModel

<MudTable ServerData="ServerReload" Dense Hover @ref="table" Loading="IsBusyProgress">
    <ToolBarContent>
        <MudText Typo="Typo.h6">Клиенты (розница)</MudText>
        <MudSpacer />
        <MudTextField T="string" ValueChanged="@(s => OnSearch(s))" Placeholder="Search" Adornment="Adornment.Start"
                      AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
    </ToolBarContent>
    <HeaderContent>
        <MudTh>ФИО</MudTh>
        <MudTh>Username</MudTh>
        <MudTh>Баланс</MudTh>
        <MudTh>Контакты</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="ФИО"><a href="/retail/client-card/@context.UserId">@context.GivenName @context.Surname @context.Patronymic</a></MudTd>
        <MudTd DataLabel="Username"><a href="/retail/client-card/@context.UserId">@context.UserName</a></MudTd>
        <MudTd DataLabel="Баланс">
            <ClientsBalancesComponent Wallets="[..WalletsCache.Where(x => x.Balance != 0 && x.UserIdentityId == context.UserId)]" />
        </MudTd>
        <MudTd DataLabel="Контакты">
            <span class="me-2">
                @context.PhoneNumber
                @if (context.RequestChangePhone != context.PhoneNumber)
                {
                    <strong class="ms-2">запрос на изменение телефона: @context.RequestChangePhone</strong>
                }
            </span>
            <span class="me-2">@context.KladrTitle @context.AddressUserComment</span>
        </MudTd>
    </RowTemplate>
    <NoRecordsContent>
        <MudText>No matching records found</MudText>
    </NoRecordsContent>
    <LoadingContent>
        <MudText>Loading...</MudText>
    </LoadingContent>
    <PagerContent>
        <MudTablePager />
    </PagerContent>
</MudTable>
<MudExpansionPanels Class="mt-2">
    <MudExpansionPanel Text="Добавить нового клиента" Gutters>
        <div class="card">
            <div class="card-body">
                <MudGrid>
                    <MudItem xs="6">
                        <div class="mb-3">
                            <label for="exampleInputEmail1" class="form-label">Email (Username)</label>
                            <input type="email" class="form-control" id="exampleInputEmail1" @bind-value="newUser.UserName" @bind-value:event="oninput">
                        </div>
                    </MudItem>
                    <MudItem xs="6">
                        <div class="mb-3">
                            <label for="exampleInputPhone1" class="form-label">Телефон</label>
                            <input type="tel" class="form-control" id="exampleInputPhone1" @bind-value="newUser.PhoneNumber" @bind-value:event="oninput">
                        </div>
                    </MudItem>
                    <MudItem xs="4">
                        <div class="mb-3">
                            <label for="exampleInputSurname1" class="form-label">Фамилия</label>
                            <input type="text" class="form-control" id="exampleInputSurname1" @bind-value="newUser.GivenName" @bind-value:event="oninput">
                        </div>
                    </MudItem>
                    <MudItem xs="4">
                        <div class="mb-3">
                            <label for="exampleInputLastName1" class="form-label">Имя</label>
                            <input type="text" class="form-control" id="exampleInputLastName1" @bind-value="newUser.Surname" @bind-value:event="oninput">
                        </div>
                    </MudItem>
                    <MudItem xs="4">
                        <div class="mb-3">
                            <label for="exampleInputPatronymic1" class="form-label">Отчество</label>
                            <input type="text" class="form-control" id="exampleInputPatronymic1" @bind-value="newUser.Patronymic" @bind-value:event="oninput">
                        </div>
                    </MudItem>
                </MudGrid>
                <div class="d-grid gap-2">
                    <button @onclick="CreateNewUser" class="btn btn-primary" disabled="@DisableCreatingUser">Создать</button>
                </div>
            </div>
        </div>
    </MudExpansionPanel>
</MudExpansionPanels>