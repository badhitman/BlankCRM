@using MudBlazor

@inherits BlazorBusyComponentBaseAuthModel

@if (IsBusyProgress || DirectoryData is null)
{
    <MudProgressLinear Color="Color.Primary" Indeterminate Class="my-3" data-cn="@this.GetType().Name" />
}
else
{
    <div class="card">
        <div class="card-body">
            <h6 class="card-title">
                @DirectoryData.FullPath
                @if (DirectoryData.DirectoryItems is not null && DirectoryData.DirectoryItems.Count != 0)
                {
                    <sup class="badge text-bg-primary ms-2">
                        x @DirectoryData.DirectoryItems.Count ( @(GlobalToolsStandard.SizeDataAsString(DirectoryData.DirectoryItems.Sum(x => x.FileSizeBytes))) )
                    </sup>
                }
                <i class="bi bi-copy ms-2" style="cursor:pointer" title="Скопировать путь в буфер обмена" @onclick="() => ClipboardCopyHandle(FolderPath)"></i>
            </h6>
            @if (DirectoryData.DirectoryItems is null || DirectoryData.DirectoryItems.Count == 0)
            {
                <dl>
                    <dt>Size</dt>
                    <dd>@GlobalToolsStandard.SizeDataAsString(DirectoryData.FileSizeBytes)</dd>

                    <dt>IsDirectory</dt>
                    <dd>@DirectoryData.IsDirectory</dd>
                </dl>
            }
            else
            {
                <MudPaper Elevation="0">
                    <MudTreeView Hover @bind-SelectedValue="SelectedValue" SelectionMode="@SelectionMode.SingleSelection">
                        <ItemTemplate Context="item">
                            @foreach (DirectoryItemModel _fiElement in DirectoryData.DirectoryItems)
                            {
                                int startSegment = _fiElement.FullPath.IndexOf(DirectoryData.FullPath);
                                @* <MudTreeViewItem Value="@($"{(startSegment < 0 ? _fiElement.FullPath : $"...{_fiElement.FullPath.Substring(startSegment + DirectoryData.FullPath.Length)}")}{(_fiElement.IsDirectory ? "" : $" - {GlobalToolsStandard.SizeDataAsString(_fiElement.FileSizeBytes)}")}")"
                                                 Icon="@(_fiElement.IsDirectory? Icons.Custom.Uncategorized.Folder : Icons.Material.Filled.InsertDriveFile)"
                                                 OnDoubleClick="() => ClipboardCopyHandle(_fiElement.FullPath)" /> *@
                                <MudTreeViewItem Value="@($"{(startSegment < 0 ? _fiElement.FullPath : $"...{_fiElement.FullPath.Substring(startSegment + DirectoryData.FullPath.Length)}")}{(_fiElement.IsDirectory ? "" : $" - {GlobalToolsStandard.SizeDataAsString(_fiElement.FileSizeBytes)}")}")"
                                                 Icon="@(_fiElement.IsDirectory? Icons.Custom.Uncategorized.Folder : Icons.Material.Filled.InsertDriveFile)">
                                    <BodyContent>
                                        <div style="display: grid; grid-template-columns: 1fr auto; align-items: center; width: 100%">
                                            <MudText Style="justify-self: start;">@item.Text</MudText>
                                            <div style="justify-self: end;">
                                                <MudIconButton OnClick="() => ClipboardCopyHandle(_fiElement.FullPath)"
                                                               title="Чтобы скопировать в буфер путь к файлу"
                                                               Icon="@Icons.Material.Filled.ContentCopy"
                                                               Color="Color.Inherit"
                                                               Size="Size.Medium" />
                                                @* <MudIconButton Icon="@Icons.Material.Filled.Preview" Size="Size.Medium" Color="Color.Inherit" /> *@
                                            </div>
                                        </div>
                                    </BodyContent>
                                </MudTreeViewItem>
                            }
                        </ItemTemplate>
                    </MudTreeView>
                </MudPaper>
            }
        </div>
    </div>
}