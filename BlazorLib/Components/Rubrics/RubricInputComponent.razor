@inherits BlazorBusyComponentBaseModel

<p title="@SelectedElement" class="mb-0">
    @Title
    @if (IsBusyProgress)
    {
        <MudProgressCircular Color="Color.Primary" Size="Size.Small" Indeterminate Class="ms-1" />
    }
    else if (IsEdited)
    {
        <sup style="cursor:pointer;" title="отменить изменения" class="ms-1 link-warning" @onclick="async () => await SetRubric(RubricInitial)">сброс</sup>
    }
</p>

@foreach ((int parentId, List<UniversalBaseModel> nestedElements) _kvp in SelectSource)
{
    UniversalBaseModel? _currentSelected = _kvp.nestedElements.FirstOrDefault(x => RubricHierarchy.Any(y => y.Id == x.Id));
    <select @onchange="(ce) => HandleSelectionChange(ce, _kvp)" class="form-select" disabled="@IsBusyProgress">
        <option class="text-secondary" value="0" selected disabled>Выбор элемента</option>
        @foreach (UniversalBaseModel rubricNode in _kvp.nestedElements)
        {
            <option class="text-primary-emphasis" disabled="@rubricNode.IsDisabled" value="@rubricNode.Id" selected="@(_currentSelected?.Id == rubricNode.Id)">@rubricNode.Name</option>
        }
    </select>
}