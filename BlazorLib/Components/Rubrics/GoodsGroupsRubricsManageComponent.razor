@using static SharedLib.GlobalStaticConstantsRoutes
@using Microsoft.Extensions.Options
@using MudBlazor

@if (CommerceConf.Value.NomenclaturesRubricsPrefixes?.Any(x => !string.IsNullOrWhiteSpace(x)) != true)
{
    <RubricsManageComponent TEntity="RubricNodeBodyNomenclatureConfigComponent"
                            ContextName="@($"{Routes.GOODS_CONTROLLER_NAME}-{Routes.CATEGORIES_CONTROLLER_NAME}")" />
}
else
{
    <MudTabs Outlined Position="@Position.Left" Rounded Border ApplyEffectsToContainer @bind-ActivePanelIndex="ActiveIndex" @ref="panelRef" Style="width:100%">
        <MudTabPanel Text="По умолчанию" Style="width: 100%;">
            <RubricsManageComponent TEntity="RubricNodeBodyNomenclatureConfigComponent"
                                    ContextName="@($"{Routes.GOODS_CONTROLLER_NAME}-{Routes.CATEGORIES_CONTROLLER_NAME}")" />
        </MudTabPanel>
        @foreach (string _prefixName in CommerceConf.Value.NomenclaturesRubricsPrefixes.Where(x => !string.IsNullOrWhiteSpace(x)))
        {
            <MudTabPanel Text="@_prefixName" ID="_prefixName" Style="width:100%">
                <RubricsManageComponent TEntity="RubricNodeBodyNomenclatureConfigComponent"
                                        PrefixName="@_prefixName"
                                        ContextName="@($"{Routes.GOODS_CONTROLLER_NAME}-{Routes.CATEGORIES_CONTROLLER_NAME}")" />
            </MudTabPanel>
        }
    </MudTabs>
}

@code {
    [Inject]
    IOptions<CommerceConfigModel> CommerceConf { get; set; } = default!;

    MudTabs? panelRef;
    string? activePrefixName;
    int _activeIndex;
    int ActiveIndex
    {
        get => _activeIndex;
        set
        {
            _activeIndex = value;
            activePrefixName = panelRef?.ActivePanel?.ID?.ToString();
        }
    }
}
