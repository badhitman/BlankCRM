@inherits BlazorBusyComponentBaseModel

<MudGrid>
    <MudItem xs="12" md="2">
        <MudTextField @bind-Value="_startDate"
                      Required
                      T="DateTime?"
                      Label="Start"
                      Format="yyyy-MM-dd"
                      InputType="InputType.Date"
                      Variant="Variant.Outlined"
                      Margin="Margin.Dense"
                      Disabled="IsBusyProgress" />
    </MudItem>
    <MudItem xs="12" md="2">
        <MudTextField @bind-Value="_endDate"
                      Required
                      T="DateTime?"
                      Label="End"
                      Format="yyyy-MM-dd"
                      InputType="InputType.Date"
                      Variant="Variant.Outlined"
                      Margin="Margin.Dense"
                      Disabled="IsBusyProgress" />
    </MudItem>
    <MudItem xs="12" md="1">
        <MudNumericField @bind-Value="_coupon"
                         T="decimal?"
                         Label="Coupon"
                         Format="N2"
                         Culture="@_en"
                         Variant="Variant.Outlined"
                         Margin="Margin.Dense"
                         Disabled="IsBusyProgress" />
    </MudItem>
    <MudItem xs="12" md="1">
        <MudNumericField @bind-Value="_couponRate"
                         Required
                         T="decimal?"
                         Label="Rate"
                         Format="N2"
                         Culture="@_en"
                         Variant="Variant.Outlined"
                         Margin="Margin.Dense"
                         Disabled="IsBusyProgress" />
    </MudItem>
    <MudItem xs="12" md="1">
        <MudNumericField @bind-Value="_notional"
                         T="decimal?"
                         Label="Notional"
                         Format="N2"
                         Culture="@_en"
                         Variant="Variant.Outlined"
                         Margin="Margin.Dense"
                         Disabled="IsBusyProgress" />
    </MudItem>
    <MudItem xs="2" Class="align-content-center flex-wrap ">
        <MudButtonGroup Variant="Variant.Text">
            <MudButton EndIcon="@Icons.Material.Filled.AddCircle"
                       Color="Color.Tertiary"
                       title="create new flow"
                       OnClick="AddNewFlow"
                       Disabled="@(IsBusyProgress || _startDate == default || _endDate == default || _startDate >= _endDate || _coupon == default)">Add</MudButton>
            <RegularCashFlowGenerateComponent @ref=regularCashFlowGenerateRef
                                              IssueDate=Period.IssueDate
                                              MaturityDate=Period.MaturityDate
                                              UpdateHandle="ActionUpdate"
                                              InstrumentId="InstrumentId" />
        </MudButtonGroup>
    </MudItem>
</MudGrid>
<hr />
<MudTable ServerData="ServerReload"
          @ref=_tableRef
          Dense Hover CanCancelEdit Loading="IsBusyProgress"
          @bind-SelectedItem="selectedItem1"
          SortLabel="Sort By"
          CommitEditTooltip="Commit Edit"
          RowEditPreview="BackupItem"
          RowEditCancel="ResetItemToOriginalValues"
          RowEditCommit="ItemHasBeenCommitted"
          IsEditRowSwitchingBlocked
          EditTrigger="@TableEditTrigger.EditButton">
    <HeaderContent>
        <MudTh>Period</MudTh>
        <MudTh>Notional</MudTh>
        <MudTh>Coupon</MudTh>
        <MudTh>CouponRate</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Period">
            @context!.StartDate.ToShortDateString() - @context!.EndDate.ToShortDateString()
            <sup class="bi bi-x @(_initDeleteCashFlow == context.Id ? "text-danger-emphasis" : "")" title="удаление CashFlow" style="cursor:pointer;" @onclick="async () => await InitDeleteCashFlow(context.Id)">
                @if (_initDeleteCashFlow == context.Id)
                {
                    <text>Подтвердить удаление</text>
                }
            </sup>
        </MudTd>
        <MudTd DataLabel="Notional">@context!.Notional</MudTd>
        <MudTd DataLabel="Coupon">@context!.Coupon</MudTd>
        <MudTd DataLabel="CouponRate">@context!.CouponRate</MudTd>
    </RowTemplate>
    <RowEditingTemplate>
        <MudTd DataLabel="Period">
            <MudTextField @bind-Value="context!.StartDate"
                          T="DateTime"
                          Label="Date"
                          Format="yyyy-MM-dd"
                          InputType="InputType.Date"
                          Margin="Margin.Dense" />
            -
            <MudTextField @bind-Value="context!.EndDate"
                          T="DateTime"
                          Label="EndDate"
                          Format="yyyy-MM-dd"
                          InputType="InputType.Date"
                          Margin="Margin.Dense" />
        </MudTd>
        <MudTd DataLabel="Notional">
            <MudNumericField @bind-Value="context!.Notional"
                             T="decimal"
                             Label="Notional"
                             Format="N2"
                             Culture="@_en"
                             Margin="Margin.Dense" />
        </MudTd>
        <MudTd DataLabel="Coupon">
            <MudNumericField @bind-Value="context!.Coupon"
                             T="decimal"
                             Label="Coupon"
                             Format="N2"
                             Culture="@_en"
                             Margin="Margin.Dense" />
        </MudTd>
        <MudTd DataLabel="CouponRate">
            <MudNumericField @bind-Value="context!.CouponRate"
                             T="decimal"
                             Label="CouponRate"
                             Format="N2"
                             Culture="@_en"
                             Margin="Margin.Dense" />
        </MudTd>
    </RowEditingTemplate>
    <PagerContent>
        <MudTablePager />
    </PagerContent>
    <EditButtonContent Context="button">
        <MudIconButton Size="@Size.Small" Icon="@Icons.Material.Outlined.Edit" Class="pa-0" OnClick="@button.ButtonAction" Disabled="@button.ButtonDisabled" />
    </EditButtonContent>
</MudTable>