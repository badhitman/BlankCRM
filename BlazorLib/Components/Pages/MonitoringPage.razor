@page "/monitoring-tools"

@using BlazorLib.Components.Shared
@using BlazorLib.Components.Storage
@using BlazorLib.Components.TraceHistoryView
@using BlazorLib.Components.HelpDesk
@using Microsoft.Extensions.Options
@using MudBlazor

@rendermode @(new InteractiveServerRenderMode(prerender: false))
@attribute [Authorize(Roles = GlobalStaticConstantsRoles.Roles.Admin)]

<MudTabs @ref="_tabs" Elevation="2" Rounded ApplyEffectsToContainer PanelClass="pa-2">
    <MudTabPanel Text="Logs" ID="@typeof(LogsComponent).Name">
        <LogsComponent />
    </MudTabPanel>
    <MudTabPanel Text="История" ID="@typeof(HistoryMainWrapperComponent).Name">
        <HistoryMainWrapperComponent />
    </MudTabPanel>
    <MudTabPanel Text="SnackBar stack" ID="@typeof(SnackBarHistoryComponent).Name">
        <SnackBarHistoryComponent />
    </MudTabPanel>
    @if (ServerConfig.Value.DirectoriesReadList is not null && ServerConfig.Value.DirectoriesReadList.Length != 0)
    {
        <MudTabPanel Text="Файлы/Папки" ID="@typeof(FolderRootViewComponent).Name">
            <MudTable Items="@ServerConfig.Value.DirectoriesReadList">
                <RowTemplate>
                    <MudTd>
                        <FolderRootViewComponent FolderPath="@context" />
                    </MudTd>
                </RowTemplate>
                <PagerContent>
                    <MudTablePager PageSizeOptions="new int[] { 3, 5, 10, int.MaxValue }" />
                </PagerContent>
            </MudTable>
        </MudTabPanel>
    }
</MudTabs>
@code {
    [Inject]
    NavigationManager NavRepo { get; set; } = default!;

    [Inject]
    IOptions<ServerConfigModel> ServerConfig { get; set; } = default!;


    [SupplyParameterFromQuery(Name = "tab")]
    public string? TabActivate { get; set; }


    MudTabs? _tabs;
    bool tabIsSet;
    protected override void OnAfterRender(bool firstRender)
    {
        base.OnAfterRender(firstRender);
        if (!tabIsSet && _tabs is not null)
        {
            tabIsSet = true;
            if (!string.IsNullOrWhiteSpace(TabActivate))
                _tabs.ActivatePanelAsync(TabActivate);
        }
    }
}